---
title: "Regression on speed dating data"
author: "Jos√© Benardi de Souza Nunes"
date: 28/07/2018
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(scatterplot3d)
library(tidyverse)
library(ggfortify)
library(modelr)
library(GGally)
library(broom)
library(here)
library(scatterplot3d)
theme_set(theme_bw())
```

# Data Overview

```{r}
data <- read_csv(here("data/speed-dating.csv"),
                 progress = FALSE,
                 col_types =cols(.default = col_integer(),
                                 int_corr = col_double(),
                                 field = col_character(),
                                 from = col_character(),
                                 career = col_character(),
                                 attr = col_double(),
                                 sinc = col_double(),
                                 intel = col_double(),
                                 fun = col_double(),
                                 amb = col_double(),
                                 shar = col_double(),
                                 like = col_double(),
                                 prob = col_double(),
                                 match_es = col_double(),
                                 attr3_s = col_double(),
                                 sinc3_s = col_double(),
                                 intel3_s = col_double(),
                                 fun3_s = col_double(),
                                 amb3_s = col_double())) %>%
  mutate( age_dif =abs(age - age_o))

data %>%
  glimpse()
```

```{r}
data %>%
  na.omit(race) %>%
  ggplot(aes(race, ..prop..)) +
  geom_bar()
```

* Most of the participants are white (code = 2)
* There were no native americans involved (code = 5) 

```{r}
require(GGally)

temp <- data %>% 
  select(like,fun,amb,attr,sinc,intel,shar,
         fun3_s,amb3_s,attr3_s,sinc3_s,intel3_s) %>% 
    na.omit()

ggcorr(temp, palette = "RdBu", label = TRUE,
       hjust = 0.75, label_size = 3, nbreaks = 5) +
  ggtitle("Correlation plot for employed variables")
```

* What a person (p1) believes about herself/himself doesn't show promising results in terms of correlation
* Among what p1 thinks about p2 how *ambitious* p1 thinks p2 is shows the weakest correlation with how much p1 likes p2.
* Intelligence has interesting interactions with sincerity and ambition.

```{r}
temp <- data %>% 
  select(like,fun,attr,sinc,intel,shar) %>% 
    na.omit()

ggpairs(temp, 
        upper = list(continuous = "density"), 
        lower = list(continuous = wrap("cor", size=5)),
        axisLabels = 'show',progress = F) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

```{r}
temp %>% ## Put predictors on same scale
   mutate_at(.vars = vars(fun,attr,sinc,intel,shar),
             .funs = funs(scale(.))) -> temp

temp %>% 
  sample_n(10)
```


```{r}
temp %>%
  ggplot(aes(fun, like)) +
   stat_density2d(aes(fill = ..level..), geom = "polygon")
```

* Intuition would suggest a positive interaction between being seen as fun and being liked, that interaction being of considerable magnitude.

```{r}
temp %>%
  ggplot(aes(attr, like)) +
   stat_density2d(aes(fill = ..level..), geom = "polygon")
```

* Intuition would suggest a positive interaction between being seen as attractive and being liked (no surprise there), that interaction being of considerable magnitude.

# Testing Regression Models

```{r}
t <- data %>% na.omit()
mod <- lm(like ~ factor(from) * fun + factor(from) * attr + 
          factor(from) * shar + factor(from) * prob + factor(from) * sinc , data = t)
glance(mod) 
``` 

```{r}
tibble::as_tibble(rownames = "coefficient",
                  confint(mod)) 
```

```{r}
temp %>% glimpse()
```


```{r}
tibble::as_tibble(rownames = "coefficient",
                  confint(mod)) %>%
  filter(coefficient != "(Intercept)") %>%
  ggplot(aes(coefficient,ymin = `2.5 %`, ymax = `97.5 %`)) +
  geom_errorbar() +
  geom_hline(yintercept = 0, colour = "darkorange")
```

```{r}
termplot(mod,partial.resid=TRUE, col.res = "darkgrey")
```

```{r}
autoplot(mod)
```

```{r}
# library(rgl)
# with(temp,plot3d(like,shar,attr, col="blue", size=1, type="s", main="3D Quadratic Model Fit with Log of Income excl. Women^2"))


```

